"use strict";$(function(){d3.queue().defer(d3.json,"./json/gooee/name_map.json").defer(d3.json,"./json/gooee/location.json").defer(d3.json,"./json/gooee/data_C.json").defer(d3.json,"./json/gooee/data_B.json").awaitAll(function(t,e){if(t)throw t;var n={width:1e3,height:1e3},r=d3.select("svg").attr("width",n.width).attr("height",n.height).style("background-color","lightgray"),a=[],o=d3.scaleLinear().domain([0,100]).range([0,1e3]),i={max:0,start:4,section:4,range:6},c={max:0,start:2,section:4,range:2},d=e[0],s=e[1],u=e[2],l=e[3];for(var f in d)m=d[f],a.push({id:f,name:m});var g=d3.map(a,function(t){return t.id});for(var f in s){var x=s[f][0],v=s[f][1],m=(V=g.get(f)).name;V.location={cx:x,cy:v}}for(var f in u){var h=u[f],m=(V=g.get(f)).name;g.get(f).radius=h,g.get(f).end=[],i.max=h>i.max?h:i.max}var y=d3.range(i.start,i.start+i.section*i.range,i.range),p=d3.scaleQuantize().domain([0,i.max]).range(y);for(var f in l){var j=l[f].start,k=l[f].end,w=l[f].count,A=g.get(j),N=g.get(k),z=N.name,x=N.location.cx,v=N.location.cy;A.end.push({lines:[[A.location.cx,A.location.cy],[x,v]],count:w,id:z}),c.max=w>c.max?w:c.max}for(var Q=d3.range(c.start,c.start+c.section*c.range,c.range),_=d3.scaleQuantize().domain([0,c.max]).range(Q),C=d3.scaleQuantize().domain([0,c.max]).range(d3.range(c.section)),b=d3.interpolate("yellowgreen","darkred"),q=d3.drag().on("start",function(t){d3.select(this.parentNode).raise().classed("active",!0)}).on("drag",function(t){var e=d3.select(this.parentNode),n=e.attr("id");d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y),e.select("text").attr("x",function(t){return d3.event.x+p(t.radius)}).attr("y",function(t){return d3.event.y-p(t.radius)}),e.selectAll("path").attr("d",function(t){return t.lines[0][0]=o.invert(d3.event.x),t.lines[0][1]=o.invert(d3.event.y),D(t.lines)}),d3.selectAll("."+n).attr("d",function(t){return t.lines[1][0]=o.invert(d3.event.x),t.lines[1][1]=o.invert(d3.event.y),D(t.lines)})}).on("end",function(t){d3.select(this).classed("active",!1)}),B=r.selectAll("g").data(a).enter().append("g").attr("data-code",function(t){return t.id}).attr("id",function(t){return t.name}),H=g.keys(),L=0;L<H.length;L++){var V=g.get(H[L]),$=V.end,z=V.name,D=d3.line().curve(d3.curveCardinal).x(function(t){return o(t[0])}).y(function(t){return o(t[1])});d3.linkHorizontal().x(function(t){return o(t.x)}).y(function(t){return o(t.y)}),d3.linkVertical().x(function(t){return o(t.x)}).y(function(t){return o(t.y)}),d3.select("#"+z).selectAll("path").data($).enter().append("path").attr("class",function(t){return t.id}).attr("d",function(t){return D(t.lines)}).attr("stroke",function(t){return b(C(t.count)/(c.section-1))}).attr("stroke-width",function(t){return _(t.count)}).attr("fill","none").attr("marker-end","url(#arrow)")}var E=B.append("circle").attr("cx",function(t){return o(t.location.cx)}).attr("cy",function(t){return o(t.location.cy)}).attr("r",function(t){return p(t.radius)}).call(q);B.append("text").attr("x",function(t){return o(t.location.cx)+p(t.radius)}).attr("y",function(t){return o(t.location.cy)-p(t.radius)}).text(function(t){return t.name}),E.on("mouseover",function(){d3.select(this.parentNode).select("text").text(function(t){return t.name+" ("+t.id+")"})}),E.on("mouseout",function(){d3.select(this.parentNode).select("text").text(function(t){return t.name})}),d3.select("#N8").select("circle").attr("fill","coral")})});
//# sourceMappingURL=gooee.js.map

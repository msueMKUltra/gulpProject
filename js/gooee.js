"use strict";$(function(){d3.queue().defer(d3.json,"./json/gooee/name_map.json").defer(d3.json,"./json/gooee/location.json").defer(d3.json,"./json/gooee/data_C.json").defer(d3.json,"./json/gooee/data_B.json").awaitAll(function(t,e){function n(t,e,n,r){if(t>n)a=e>r?t:n;else var a=e>r?n:t;if(e>r)i=t>n?r:e;else var i=t>n?e:r;return[a,i]}if(t)throw t;var r={width:1e3,height:1e3},a=d3.select("svg").attr("width",r.width).attr("height",r.height).style("background-color","steelblue"),i=[],o=d3.scaleLinear().domain([0,100]).range([0,1e3]),d={max:0,start:4,section:4,range:6},c={max:0,start:1,section:4,range:1},s=e[0],l=e[1],u=e[2],f=e[3];for(var g in s)h=s[g],i.push({id:g,name:h});var v=d3.map(i,function(t){return t.id});for(var g in l){var x=l[g][0],m=l[g][1],h=(X=v.get(g)).name;X.location={cx:x,cy:m}}for(var g in u){var p=u[g],h=(X=v.get(g)).name;v.get(g).radius=p,v.get(g).end=[],d.max=p>d.max?p:d.max}for(var y=d3.range(d.start,d.start+d.section*d.range,d.range),j=d3.scaleQuantize().domain([0,d.max]).range(y),k=j.range(),w=d3.scaleOrdinal().domain(j.range()).range([7,8.5,10,11.5]),A=0;A<k.length;A++)a.append("defs").append("marker").attr("id","arrow"+k[A]).attr("markerUnits","userSpaceOnUse").attr("markerWidth","32").attr("markerHeight","32").attr("viewBox","0 0 8 8").attr("refX",w(k[A])).attr("refY","4").attr("orient","auto").append("path").attr("d","M2,2 L6,4 L2,6 L3,4 L2,2").attr("fill","white");for(var g in f){var L=f[g].start,z=f[g].end,b=f[g].count,B=v.get(L),Q=v.get(z),_=Q.name,p=Q.radius,H=B.location.cx,O=B.location.cy,U=n(H,O,x=Q.location.cx,m=Q.location.cy);B.end.push({lines:[[H,O],U,[x,m]],count:b,id:_,radius:p}),c.max=b>c.max?b:c.max}for(var q=d3.range(c.start,c.start+c.section*c.range,c.range),C=d3.scaleQuantize().domain([0,c.max]).range(q),M=d3.scaleQuantize().domain([0,c.max]).range(d3.range(c.section)),N=d3.interpolate("yellowgreen","indianred"),S=d3.drag().on("start",function(t){}).on("drag",function(t){var e=d3.select(this),r=e.attr("data-id"),a=d3.select("#"+r);e.attr("cx",d3.event.x).attr("cy",d3.event.y),a.select("text").attr("x",function(t){return d3.event.x+j(t.radius)}).attr("y",function(t){return d3.event.y-j(t.radius)}),a.selectAll("path").attr("d",function(t){t.lines[0][0]=o.invert(d3.event.x),t.lines[0][1]=o.invert(d3.event.y);var e=n(t.lines[0][0],t.lines[0][1],t.lines[2][0],t.lines[2][1]);return t.lines[1][0]=e[0],t.lines[1][1]=e[1],D(t.lines)}),d3.selectAll("."+r).attr("d",function(t){t.lines[2][0]=o.invert(d3.event.x),t.lines[2][1]=o.invert(d3.event.y);var e=n(t.lines[0][0],t.lines[0][1],t.lines[2][0],t.lines[2][1]);return t.lines[1][0]=e[0],t.lines[1][1]=e[1],D(t.lines)})}).on("end",function(t){d3.select(this).classed("active",!1)}),V=a.selectAll("g").data(i).enter().append("g").attr("data-code",function(t){return t.id}).attr("id",function(t){return t.name}),W=v.keys(),A=0;A<W.length;A++){var X=v.get(W[A]),Y=X.end,_=X.name,D=d3.line().curve(d3.curveBundle.beta(.5)).x(function(t){return o(t[0])}).y(function(t){return o(t[1])});d3.linkHorizontal().x(function(t){return o(t.x)}).y(function(t){return o(t.y)}),d3.linkVertical().x(function(t){return o(t.x)}).y(function(t){return o(t.y)}),d3.select("#"+_).selectAll("path").data(Y).enter().append("path").attr("class",function(t){return t.id}).attr("d",function(t){return D(t.lines)}).attr("stroke",function(t){return N(M(t.count)/(c.section-1))}).attr("stroke-width",function(t){return C(t.count)}).attr("fill","none").attr("marker-end",function(t){return"url(#arrow"+j(t.radius)+")"})}var E=a.selectAll("cilcle").data(i).enter().append("circle").attr("cx",function(t){return o(t.location.cx)}).attr("cy",function(t){return o(t.location.cy)}).attr("r",function(t){return j(t.radius)}).attr("data-id",function(t){return t.name}).call(S);V.append("text").attr("x",function(t){return o(t.location.cx)+j(t.radius)}).attr("y",function(t){return o(t.location.cy)-j(t.radius)}).attr("fill","ivory").text(function(t){return t.name}),E.on("mouseover",function(){var t=d3.select(this).attr("data-id");d3.select("#"+t).select("text").text(function(t){return t.name+" ("+t.id+")"})}),E.on("mouseout",function(){var t=d3.select(this).attr("data-id");d3.select("#"+t).select("text").text(function(t){return t.name})}),$('[data-id="N8"]').attr("fill","gold")})});
//# sourceMappingURL=gooee.js.map

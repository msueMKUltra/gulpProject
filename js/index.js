"use strict";$(function(){function t(t,e){t.find("li").hover(function(){$(this).addClass(e)},function(){$(this).removeClass(e)})}function e(t,e){return d3.map(t,function(t){return t.id}).get(e)}function n(){r(".roller-svg-001",f),r(".roller-svg-002",v),r(".roller-svg-003",w),r(".roller-svg-004",y)}function r(t,e){var n=e.data,r={width:$(".roller-piece").eq(2).width()-30,height:100},o=d3.select(".roller-card-zone").select(t);o.selectAll("*").remove();var a=o.append("svg").attr("width",r.width).attr("height",r.height),i=n.map(function(t){return t.month}),l=n.map(function(t){return t.people}),p=d3.max(l),d={top:14,right:20,bottom:20,left:40},s={width:d3.scaleBand().domain(i).range([0,r.width-d.left-d.right]).padding(.5),height:d3.scaleLinear().domain([0,p]).range([r.height-d.top-d.bottom,0])};a.selectAll("rect").data(n).enter().append("rect").attr("fill","skyblue").attr("x",function(t){return s.width(t.month)+d.left}).attr("y",function(t){return s.height(t.people)+d.top}).attr("width",s.width.bandwidth()).attr("height",function(t){return r.height-d.top-d.bottom-s.height(t.people)}),a.selectAll("text").data(n).enter().append("text").attr("fill","deepskyblue").attr("font-size","10px").attr("text-anchor","middle").attr("x",function(t){return s.width(t.month)+d.left}).attr("y",function(t){return s.height(t.people)+d.top}).attr("dx",s.width.bandwidth()/2).attr("dy",-4).text(function(t){return t.people});a.append("g").call(d3.axisBottom(s.width)).attr("transform","translate("+d.left+","+(r.height-d.bottom)+")"),a.append("g").call(d3.axisLeft(s.height).ticks(3).tickFormat(function(t){return t+"人"})).attr("transform","translate("+d.left+","+d.top+")")}function o(t,e){var n=d3.map(t,function(t){return t.id}).get(e),r=0;n.data.map(function(t){r+=t.gameCount});var o=d3.map(n);o=o.set("total",r);var a=0,i=[];n.data.map(function(t){var e=a+t.gameCount;i.push({startAngle:Math.PI*a/r*2,endAngle:Math.PI*e/r*2}),a=e});var l={};return(o=o.set("angle",i)).each(function(t,e){l[e]=t}),l}function a(t,e){var n={width:200,height:100},r={top:10,bottom:10,left:12,right:20},o={inner:0,outer:(n.height-r.top-r.bottom)/2},a={width:12,height:12},i=b.select(t);i.selectAll("*").remove();var l=i.append("svg").attr("width",n.width).attr("height",n.height),p=e.angle,d=e.data.map(function(t){return t.gameCount}),s=e.data.map(function(t){return t.sportType}),c=d3.arc().innerRadius(o.inner).outerRadius(o.outer),h=(d3.scaleOrdinal(d3.schemeCategory10),d3.range(d.length)),u=d3.scaleOrdinal().domain(h).range(["#E4B54E","#96CFDB","#D1427F"]);l.append("text").attr("x",n.width).attr("y",n.height).attr("text-anchor","end").attr("fill","white").text("本月參與人次").classed("roller-text-shadow",!0).attr("transform","translate( -10, -10)");var g=l.append("g").classed("cilcle",!0);g.selectAll("path").data(p).enter().append("path").attr("transform","translate("+(r.left+o.outer)+","+(r.top+o.outer)+")").attr("d",function(t){return c(t)}).attr("fill",function(t,e){return u(e)}).attr("opacity",.6),g.selectAll("text").data(p).enter().append("text").attr("text-anchor","middle").attr("fill","white").attr("font-size","10px").attr("y",4).attr("transform",function(t){return"translate("+(r.left+o.outer)+","+(r.top+o.outer)+")translate("+c.centroid(t)+")"}).data(d).text(function(t){return t});var m=l.append("g").classed("tag",!0);m.selectAll("rect").data(p).enter().append("rect").attr("width",a.width).attr("height",a.height).attr("x",3*o.outer-12).attr("y",function(t,e){return 20*e+r.top}).attr("fill",function(t,e){return u(e)}).attr("opacity",.7),m.selectAll("text").data(s).enter().append("text").attr("font-size","12px").attr("fill","white").attr("x",3*o.outer-12).attr("y",function(t,e){return 20*e+r.top}).attr("transform","translate("+(a.width+4)+","+(a.height-2)+")").text(function(t){return t})}function i(t,e,n,r,o,a,i){this.svg={width:t,height:e},this.files={json:n,shp:r},this.projection={center:[o,a],scale:i}}function l(t){d3.json("../map"+t.files.json,function(e){function n(){var e=($(".roller-map").width()-30)/t.svg.width;e=e>1?1:e,i.attr("transform","scale("+e+")");var n=O.selectAll("button");return n.empty()||n.data(t.btn).style("transform",function(t){return"translate("+t.x*e+"px,"+t.y*e+"px)"}),e}var r=topojson.feature(e,e.objects[t.files.shp]).features,o=d3.geoMercator().center(t.projection.center).scale(t.projection.scale),a=d3.geoPath().projection(o),i=O.append("svg").attr("width",t.svg.width).attr("height",t.svg.height);!function(){i.selectAll("path").data(r).enter().append("path").attr("d",a);var e=n();O.selectAll("button").data(t.btn).enter().append("button").attr("class","roller-point btn btn-lg btn-primary rounded-circle").attr("type","button").attr("data-toggle","popover").attr("data-placement","top").attr("title",function(t){return t.title}).attr("data-content",function(t){return t.content}).transition().duration(2e3).style("transform",function(t){return"translate("+t.x*e+"px,"+t.y*e+"px)"}),$('[data-toggle="popover"]').popover()}(),x.on("window:resize",function(){n()})})}var p=$(".roller-list"),d=$(".roller-taiwan"),s=$(".roller-forein"),c=($(".roller-map"),$(".roller-game-taiwan")),h=$(".roller-game-asia"),u=$(".roller-game-america"),g=$(".roller-game-europe");p.hover(function(){p.removeClass("col-md-6 col-md-2 col-md-3"),$(this).addClass("col-md-6").siblings(".roller-list").addClass("col-md-2")},function(){p.removeClass("col-md-6 col-md-2").addClass("col-md-3")}),t(c,"list-group-item-warning"),t(h,"list-group-item-danger"),t(u,"list-group-item-info"),t(g,"list-group-item-success");var m=[{id:"001",data:[{month:"Aug",people:10},{month:"Sep",people:6},{month:"Oct",people:17},{month:"Nov",people:12}]},{id:"002",data:[{month:"Aug",people:50},{month:"Sep",people:77},{month:"Oct",people:43},{month:"Nov",people:99}]},{id:"003",data:[{month:"Aug",people:81},{month:"Sep",people:71},{month:"Oct",people:69},{month:"Nov",people:54}]},{id:"004",data:[{month:"Aug",people:4},{month:"Sep",people:7},{month:"Oct",people:15},{month:"Nov",people:22}]}],f=e(m,"001"),v=e(m,"002"),w=e(m,"003"),y=e(m,"004"),x=$(window);x.resize(function(){x.trigger("window:resize")}),n(),x.on("window:resize",function(){n()});var C=[{id:"001",data:[{sportType:"Running",gameCount:10},{sportType:"Swimming",gameCount:6},{sportType:"Cycling",gameCount:17}]},{id:"002",data:[{sportType:"Running",gameCount:50},{sportType:"Swimming",gameCount:77},{sportType:"Cycling",gameCount:43}]},{id:"003",data:[{sportType:"Running",gameCount:81},{sportType:"Swimming",gameCount:71},{sportType:"Cycling",gameCount:69}]},{id:"004",data:[{sportType:"Running",gameCount:4},{sportType:"Swimming",gameCount:7},{sportType:"Cycling",gameCount:15}]}],b=d3.select(".roller-list-zone"),A=o(C,"001"),T=o(C,"002"),j=o(C,"003"),z=o(C,"004");a(".roller-svg-001",A),a(".roller-svg-002",T),a(".roller-svg-003",j),a(".roller-svg-004",z);var O=d3.select(".roller-jumbotron-zone .roller-svg"),S=new i(300,400,"/taiwan/taiwan.json","COUNTY_MOI_1060525",124,23.3,6e3),k=new i(600,400,"/world/world.json","ne_110m_admin_0_countries_lakes",120,20,90);S.btn=[{title:"北部據點",content:"大佳河濱公園",x:40,y:-150},{title:"中部據點",content:"圳前仁愛公園",x:-50,y:-30},{title:"南部據點",content:"巴克禮紀念公園",x:-70,y:80},{title:"東部據點",content:"台東森林公園",x:50,y:50}],k.btn=[{title:"北美洲據點",content:"黃石國家公園",x:-200,y:-40},{title:"南美洲據點",content:"泰羅那國家公園",x:-110,y:90},{title:"歐洲據點",content:"迷你歐洲公園",x:10,y:-10},{title:"非洲據點",content:"克留格爾國家公園",x:40,y:100},{title:"亞洲據點",content:"張家界國家森林公園",x:150,y:20},{title:"大洋洲據點",content:"努沙國家公園",x:220,y:120}],l(S),d.click(function(){$(this).find("a").hasClass("active")||($('[data-toggle="popover"]').popover("hide"),O.selectAll("*").remove(),l(S))}),s.click(function(){$(this).find("a").hasClass("active")||($('[data-toggle="popover"]').popover("hide"),O.selectAll("*").remove(),l(k))})});
//# sourceMappingURL=index.js.map

"use strict";$(function(){function t(t,e){t.find("li").hover(function(){$(this).addClass(e)},function(){$(this).removeClass(e)})}function e(t,e){return d3.map(t,function(t){return t.id}).get(e)}function n(){r(".roller-svg-001",A),r(".roller-svg-002",S),r(".roller-svg-003",T),r(".roller-svg-004",j)}function a(t,e,n){var a=t.offset().top-100,r=$(document).scrollTop(),o=t.height()+200;return e?r>=a&&(n(),e=!1):(r<a||r>a+o)&&(e=!0),e}function r(t,e){var n=e.data,a={width:$(".roller-piece").eq(2).width()-30,height:100},r=d3.select(".roller-card-zone").select(t);r.selectAll("*").remove();var o=r.append("svg").attr("width",a.width).attr("height",a.height),i=n.map(function(t){return t.month}),l=n.map(function(t){return t.people}),s=d3.max(l),d={top:14,right:20,bottom:20,left:40},p={width:d3.scaleBand().domain(i).range([0,a.width-d.left-d.right]).padding(.5),height:d3.scaleLinear().domain([0,s]).range([a.height-d.top-d.bottom,0])};o.selectAll("rect").data(n).enter().append("rect").attr("fill","skyblue").attr("x",function(t){return p.width(t.month)+d.left}).attr("y",a.height-d.bottom).attr("width",p.width.bandwidth()).attr("height",0).transition().duration(600).ease(d3.easeSin).delay(function(t,e){return 200*e}).attr("y",function(t){return p.height(t.people)+d.top}).attr("height",function(t){return a.height-d.top-d.bottom-p.height(t.people)}),o.selectAll("text").data(n).enter().append("text").attr("fill","deepskyblue").attr("font-size","10px").attr("text-anchor","middle").attr("opacity",0).attr("x",function(t){return p.width(t.month)+d.left}).attr("y",function(t){return p.height(t.people)+d.top}).attr("dx",p.width.bandwidth()/2).attr("dy",-4).text(function(t){return t.people}).transition().duration(400).delay(function(t,e){return 400+200*e}).attr("opacity",1);o.append("g").call(d3.axisBottom(p.width)).attr("transform","translate("+d.left+","+(a.height-d.bottom)+")"),o.append("g").call(d3.axisLeft(p.height).ticks(3).tickFormat(function(t){return t+"人"})).attr("transform","translate("+d.left+","+d.top+")")}function o(t,e){var n=d3.map(t,function(t){return t.id}).get(e),a=0;n.data.map(function(t){a+=t.gameCount});var r=d3.map(n);r=r.set("total",a);var o=0,i=[];n.data.map(function(t){var e=o+t.gameCount;i.push({startAngle:Math.PI*o/a*2,endAngle:Math.PI*e/a*2}),o=e});var l={};return(r=r.set("angle",i)).each(function(t,e){l[e]=t}),l}function i(){l(".roller-svg-001",R),l(".roller-svg-002",E),l(".roller-svg-003",M),l(".roller-svg-004",B)}function l(t,e){var n={width:200,height:100},a={top:10,bottom:10,left:12,right:20},r={inner:0,outer:(n.height-a.top-a.bottom)/2},o={width:12,height:12},i=N.select(t);i.selectAll("*").remove();var l=i.append("svg").attr("width",n.width).attr("height",n.height),s=e.angle,d=e.data.map(function(t){return t.gameCount}),p=e.data.map(function(t){return t.sportType}),c=d3.arc().innerRadius(r.inner).outerRadius(r.outer),u=(d3.scaleOrdinal(d3.schemeCategory10),d3.range(d.length)),h=d3.scaleOrdinal().domain(u).range(["#E4B54E","#96CFDB","#D1427F"]);l.append("text").attr("x",n.width).attr("y",n.height).attr("text-anchor","end").attr("fill","white").text("本月參與人次").classed("roller-text-shadow",!0).attr("transform","translate( -10, -10)");var m=l.append("g").classed("cilcle",!0);m.selectAll("path").data(s).enter().append("path").attr("transform","translate("+(a.left+r.outer)+","+(a.top+r.outer)+")").attr("d",function(t){return c(t)}).attr("fill",function(t,e){return h(e)}).attr("opacity",0).transition().duration(1e3).ease(d3.easeSin).delay(function(t,e){return 500*e}).attr("opacity",.6),m.selectAll("text").data(s).enter().append("text").attr("text-anchor","middle").attr("fill","white").attr("font-size","10px").attr("y",4).attr("transform",function(t){return"translate("+(a.left+r.outer)+","+(a.top+r.outer)+")translate("+c.centroid(t)+")"}).data(d).text(function(t){return t}).attr("opacity",0).transition().duration(1200).ease(d3.easeSin).delay(function(t,e){return 500*e}).attr("opacity",1);var g=l.append("g").classed("tag",!0);g.selectAll("rect").data(s).enter().append("rect").attr("width",o.width).attr("height",o.height).attr("x",3*r.outer-12).attr("y",function(t,e){return 20*e+a.top}).attr("fill",function(t,e){return h(e)}).attr("opacity",0).transition().duration(1e3).ease(d3.easeSin).delay(function(t,e){return 500*e}).attr("opacity",.7),g.selectAll("text").data(p).enter().append("text").attr("font-size","12px").attr("fill","white").attr("x",3*r.outer-12).attr("y",function(t,e){return 20*e+a.top}).attr("transform","translate("+(o.width+4)+","+(o.height-2)+")").text(function(t){return t}).attr("opacity",0).transition().duration(1200).ease(d3.easeSin).delay(function(t,e){return 500*e}).attr("opacity",1)}function s(t,e,n,a,r,o,i){this.svg={width:t,height:e},this.files={json:n,shp:a},this.projection={center:[r,o],scale:i}}function d(t){d3.json(t.files.json,function(e){function n(){var e=($(".roller-map").width()-30)/t.svg.width;e=e>1?1:e,i.attr("transform","scale("+e+")");var n=D.selectAll("button");return n.empty()||n.data(t.btn).style("transform",function(t){return"translate("+t.x*e+"px,"+t.y*e+"px)"}),e}var a=topojson.feature(e,e.objects[t.files.shp]).features,r=d3.geoMercator().center(t.projection.center).scale(t.projection.scale),o=d3.geoPath().projection(r),i=D.append("svg").attr("width",t.svg.width).attr("height",t.svg.height);!function(){i.selectAll("path").data(a).enter().append("path").attr("d",o);var e=n();D.selectAll("button").data(t.btn).enter().append("button").attr("class","roller-point btn btn-lg btn-primary rounded-circle").attr("type","button").attr("data-toggle","popover").attr("data-placement","top").attr("title",function(t){return t.title}).attr("data-content",function(t){return t.content}).transition().duration(2e3).style("transform",function(t){return"translate("+t.x*e+"px,"+t.y*e+"px)"}),$('[data-toggle="popover"]').popover()}(),z.on("window:resize",function(){n()})})}function p(t){h(t,""!=t.val())}function c(t){h(t,0!=t.find("option:selected").index())}function u(t){m(t,t.prop("checked"))}function h(t,e){var n=document.createElement("i");e?t.siblings(".roller-label").empty().append(n).find("i").addClass("fa fa-thumbs-o-up").closest(".roller-tip").addClass("has-success").removeClass("has-danger"):t.siblings(".roller-label").empty().append(n).find("i").addClass("fa fa-hand-o-left").closest(".roller-tip").addClass("has-danger").removeClass("has-success")}function m(t,e){var n=document.createElement("i"),a=t.closest(".roller-tip");a.find("i").remove(),e?a.prepend(n).find("i").addClass("custom-control mr-1 fa fa-thumbs-o-up").end().removeClass("has-danger"):a.prepend(n).find("i").addClass("custom-control mr-1 fa fa-hand-o-right").end().addClass("has-danger")}var g=$(".roller-list"),f=$(".roller-taiwan"),v=$(".roller-forein"),y=($(".roller-map"),$(".roller-game-taiwan")),w=$(".roller-game-asia"),x=$(".roller-game-america"),C=$(".roller-game-europe");g.hover(function(){g.removeClass("col-md-6 col-md-2 col-md-3"),$(this).addClass("col-md-6").siblings(".roller-list").addClass("col-md-2")},function(){g.removeClass("col-md-6 col-md-2").addClass("col-md-3")}),t(y,"list-group-item-warning"),t(w,"list-group-item-danger"),t(x,"list-group-item-info"),t(C,"list-group-item-success");var b=[{id:"001",data:[{month:"Aug",people:10},{month:"Sep",people:6},{month:"Oct",people:17},{month:"Nov",people:12}]},{id:"002",data:[{month:"Aug",people:50},{month:"Sep",people:77},{month:"Oct",people:43},{month:"Nov",people:99}]},{id:"003",data:[{month:"Aug",people:81},{month:"Sep",people:71},{month:"Oct",people:69},{month:"Nov",people:54}]},{id:"004",data:[{month:"Aug",people:4},{month:"Sep",people:7},{month:"Oct",people:15},{month:"Nov",people:22}]}],A=e(b,"001"),S=e(b,"002"),T=e(b,"003"),j=e(b,"004"),z=$(window);z.resize(function(){z.trigger("window:resize")});var k=!0,O=!0;z.scroll(function(){k=a($(".roller-card-zone"),k,n),O=a($(".roller-list-zone"),O,i)}),n(),z.on("window:resize",function(){n()});var _=[{id:"001",data:[{sportType:"Running",gameCount:10},{sportType:"Swimming",gameCount:6},{sportType:"Cycling",gameCount:17}]},{id:"002",data:[{sportType:"Running",gameCount:50},{sportType:"Swimming",gameCount:77},{sportType:"Cycling",gameCount:43}]},{id:"003",data:[{sportType:"Running",gameCount:81},{sportType:"Swimming",gameCount:71},{sportType:"Cycling",gameCount:69}]},{id:"004",data:[{sportType:"Running",gameCount:4},{sportType:"Swimming",gameCount:7},{sportType:"Cycling",gameCount:15}]}],N=d3.select(".roller-list-zone"),R=o(_,"001"),E=o(_,"002"),M=o(_,"003"),B=o(_,"004");i();var D=d3.select(".roller-jumbotron-zone .roller-svg"),F=new s(300,400,"map/taiwan/taiwan.json","COUNTY_MOI_1060525",124,23.3,6e3),I=new s(600,400,"map/world/world.json","ne_110m_admin_0_countries_lakes",120,20,90);F.btn=[{title:"北部據點",content:"大佳河濱公園",x:40,y:-150},{title:"中部據點",content:"圳前仁愛公園",x:-50,y:-30},{title:"南部據點",content:"巴克禮紀念公園",x:-70,y:80},{title:"東部據點",content:"台東森林公園",x:50,y:50}],I.btn=[{title:"北美洲據點",content:"黃石國家公園",x:-200,y:-40},{title:"南美洲據點",content:"泰羅那國家公園",x:-110,y:90},{title:"歐洲據點",content:"迷你歐洲公園",x:10,y:-10},{title:"非洲據點",content:"克留格爾國家公園",x:40,y:100},{title:"亞洲據點",content:"張家界國家森林公園",x:150,y:20},{title:"大洋洲據點",content:"努沙國家公園",x:220,y:120}],d(F),f.click(function(){$(this).find("a").hasClass("active")||($('[data-toggle="popover"]').popover("hide"),D.selectAll("*").remove(),d(F))}),v.click(function(){$(this).find("a").hasClass("active")||($('[data-toggle="popover"]').popover("hide"),D.selectAll("*").remove(),d(I))});var P=$("#inputName"),L=$("#inputEmail"),q=$("#selectSubject"),U=$("#textareaMessage"),Y=$("#inputCheck");$("#buttonSubmit").click(function(t){t.preventDefault(),p(P),p(L),p(U),u(Y),c(q)})});
//# sourceMappingURL=index.js.map
